<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fetch data from single assay of choice — fetch_assay_data.FacileDataSet • FacileData</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fetch data from single assay of choice — fetch_assay_data.FacileDataSet" />
<meta property="og:description" content="Fetch data from single assay of choice" />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FacileData</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.10.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/FacileData.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/FacileDataSet.html">FacileDataSet Overview</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fetch data from single assay of choice</h1>
    
    <div class="hidden name"><code>fetch_assay_data.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fetch data from single assay of choice</p>
    </div>

    <pre class="usage"><span class='co'># S3 method for FacileDataSet</span>
<span class='fu'>fetch_assay_data</span>(<span class='no'>x</span>, <span class='no'>features</span>, <span class='kw'>samples</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>assay_name</span> <span class='kw'>=</span> <span class='fu'>default_assay</span>(<span class='no'>x</span>), <span class='kw'>normalized</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>as.matrix</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='no'>...</span>, <span class='kw'>subset.threshold</span> <span class='kw'>=</span> <span class='fl'>700</span>, <span class='kw'>aggregate</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>aggregate.by</span> <span class='kw'>=</span> <span class='st'>"ewm"</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='co'># S3 method for facile_frame</span>
<span class='fu'>fetch_assay_data</span>(<span class='no'>x</span>, <span class='no'>features</span>, <span class='kw'>samples</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>assay_name</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>normalized</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>as.matrix</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='no'>...</span>,
  <span class='kw'>subset.threshold</span> <span class='kw'>=</span> <span class='fl'>700</span>, <span class='kw'>aggregate</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>aggregate.by</span> <span class='kw'>=</span> <span class='st'>"ewm"</span>,
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='fu'>normalize.assay.matrix</span>(<span class='no'>vals</span>, <span class='no'>feature.info</span>, <span class='no'>sample.info</span>, <span class='no'>fds</span>, <span class='kw'>log</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>prior.count</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>batch</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>main</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>maintain.rowmeans</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='no'>...</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>A <code>FacileDataSrote</code> object.</p></td>
    </tr>
    <tr>
      <th>features</th>
      <td><p>a feature descriptor (data.frame with assay and feature_id
columms)</p></td>
    </tr>
    <tr>
      <th>samples</th>
      <td><p>a sample descriptor to specify which samples to return data
from.</p></td>
    </tr>
    <tr>
      <th>assay_name</th>
      <td><p>the name of the assay to fetch data from. Defaults to the
value of <code>default_assay()</code> for <code>x</code>. Must be a subset of <code>assay_names(x)</code>.</p></td>
    </tr>
    <tr>
      <th>normalized</th>
      <td><p>return normalize or raw data values, defaults to
<code>raw</code></p></td>
    </tr>
    <tr>
      <th>as.matrix</th>
      <td><p>by default, the data is returned in a long-form tbl-like
result. If set to <code>TRUE</code>, the data is returned as a matrix.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>parameters to pass to normalization methods</p></td>
    </tr>
    <tr>
      <th>subset.threshold</th>
      <td><p>sometimes fetching all the genes is faster than
trying to subset. We have to figure out why that is, but I've previously
tested random features of different lengths, and around 700 features was
the elbow.</p></td>
    </tr>
    <tr>
      <th>aggregate.by</th>
      <td><p>do you want individual level results or geneset
scores? Use 'ewm' for eigenWeightedMean, and that's all.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A <code>tibble</code> (lazy or not) with assay data.</p>
    <h2 class="hasAnchor" id="removing-batch-effects"><a class="anchor" href="#removing-batch-effects"></a>Removing Batch Effects</h2>

    
    <p>We leverage limma's <code>removeBatchEffect</code> functionality, with a simplified
interface. The <code>batch</code> parameter replaces <code>batch</code>, <code>batch2</code>, and
<code>covariates</code>. The <code>design</code> parameter is replaced with <code>main</code>.</p>
<p>All these parameters must be characters, which reference columns that
have been passed down into the samples frame, or ones that we can pull
out of the facile data store and spank onto the samples frame.</p>
<p>We'll use these parameters to build a model.matrix with main and batch
effect and follow the use of <code>removeBatchEffect</code> as outlined in the post
linked to below to pull the design matrix apart and call the function with
the corresponding <code>design</code> and <code>covariates</code> parameters:</p>
<p>https://support.bioconductor.org/p/83286/#83287</p>
<p>Setting the <code>batch.scale</code> parameter to <code>TRUE</code> (the default), ensures that
the <code>rowMeans</code> of the returned data matrix are the same as the original
dataset.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other API: <code><a href='fetch_assay_score.FacileDataSet.html'>fetch_assay_score.FacileDataSet</a></code>,
  <code><a href='fetch_custom_sample_covariates.FacileDataSet.html'>fetch_custom_sample_covariates.FacileDataSet</a></code>,
  <code><a href='sample-covariates.html'>fetch_sample_covariates</a></code>,
  <code><a href='fetch_sample_statistics.FacileDataSet.html'>fetch_sample_statistics.FacileDataSet</a></code>,
  <code><a href='fetch_samples.FacileDataSet.html'>fetch_samples.FacileDataSet</a></code>,
  <code><a href='filter_features.FacileDataSet.html'>filter_features.FacileDataSet</a></code>,
  <code><a href='filter_samples.FacileDataSet.html'>filter_samples.FacileDataSet</a></code>,
  <code><a href='organism.FacileDataSet.html'>organism.FacileDataSet</a></code>,
  <code><a href='samples.FacileDataSet.html'>samples.FacileDataSet</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>samples</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='exampleFacileDataSet.html'>exampleFacileDataSet</a></span>() <span class='kw'>%&gt;%</span>
  <span class='fu'>filter_samples</span>(<span class='no'>indication</span> <span class='kw'>==</span> <span class='st'>"BLCA"</span>, <span class='no'>sample_type</span> <span class='kw'>==</span> <span class='st'>"tumor"</span>)
<span class='no'>features</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='kw'>PRF1</span><span class='kw'>=</span><span class='st'>'5551'</span>, <span class='kw'>GZMA</span><span class='kw'>=</span><span class='st'>'3001'</span>, <span class='kw'>CD274</span><span class='kw'>=</span><span class='st'>'29126'</span>)
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='fu'>with_assay_data</span>(<span class='no'>samples</span>, <span class='no'>features</span>, <span class='kw'>normalized</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>batch</span> <span class='kw'>=</span> <span class='st'>"sex"</span>)
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='fu'>with_assay_data</span>(<span class='no'>samples</span>, <span class='no'>features</span>, <span class='kw'>normalized</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
                       <span class='kw'>batch</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"sex"</span>, <span class='st'>"RIN"</span>), <span class='kw'>normalized</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; <span class='error'>Error in with_assay_data(samples, features, normalized = TRUE, batch = c("sex",     "RIN"), normalized = TRUE): formal argument "normalized" matched by multiple actual arguments</span></div><div class='input'><span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='fu'>with_assay_data</span>(<span class='no'>samples</span>, <span class='no'>features</span>, <span class='kw'>normalized</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
                       <span class='kw'>batch</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"sex"</span>, <span class='st'>"RIN"</span>), <span class='kw'>main</span> <span class='kw'>=</span> <span class='st'>"treatment"</span>)</div><div class='output co'>#&gt; <span class='error'>Error: Can't find columns `treatment`, `RIN` in `.data`.</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#removing-batch-effects">Removing Batch Effects</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Steve Lianoglou, Vincent Rouilly, Peter Haverty, Denali Therapeutics, Genentech.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

